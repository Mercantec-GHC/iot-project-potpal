@page "/Login"
@using PotPalFrontend.Repo
@inject UserRepo userRepo

<EditForm Model="@userLogin" OnValidSubmit="ConfirmLogin" FormName="loginForm">
    <div class="container-fluid vh-100 d-flex align-items-center justify-content-center">
        <div class="row w-75 shadow-lg">
            <!-- Left side: Login Form -->
            <div class="col-md-6 p-5 bg-light form-box d-flex flex-column">
                <!-- Top section: Logo, header and form fields -->
                <div>
                    <div class="d-flex align-items-center mb-4">
                        <img src="img/flower-pot-and-plant-logo-growth-logo-free-vector.jpg" alt="Company Logo" class="logo me-2" />
                        <span class="company-text fw-bold">PotPal</span>
                    </div>
                    <h2 class="text-center mb-4">Login</h2>

                    <DataAnnotationsValidator />
                    <ValidationSummary />

                    <div class="mb-3">
                        <label for="email" class="form-label">Email address</label>
                        <InputText type="email" @bind-Value="userLogin.Email" class="form-control" id="email" placeholder="Enter your email" />
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <InputText type="password" @bind-Value="userLogin.Password" class="form-control" id="password" placeholder="Enter your password" />
                    </div>
                </div>
                <!-- Bottom section: Action button and navigation link -->
                <div class="mt-auto">
                    <button type="submit" class="btn btn-primary w-100 btn-action">Confirm</button>
                    <div class="text-center mt-3 action-link">
                        <small>Don't have an account? <a href="/signup">Sign Up</a></small>
                    </div>
                </div>
            </div>
            <!-- Right side: Image -->
            <div class="col-md-6 p-0 d-none d-md-block">
                <img src="img/imagePotPal (1).png" alt="Your Image" class="img-fluid h-100 w-100" />
            </div>
        </div>
    </div>
</EditForm>

@code {
    public UserLoginDTO userLogin { get; set; } = new();
    public UserDTO? UserResult { get; set; }

    private async Task ConfirmLogin()
    {
        Console.WriteLine("▶️ ConfirmLogin called");
        UserResult = await userRepo.LoginAsync(userLogin);
        Console.WriteLine(UserResult != null
            ? $"✅ Logged in as {UserResult.UserName}"
            : "❌ Login failed");
    }
}
